apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
  name: commute
  namespace: default
spec:
  interval: 120m
  chart:
    spec:
      chart: app
      version: "0.1.2"
      sourceRef:
        kind: HelmRepository
        name: vibioh
      interval: 120m
  install:
    crds: Skip
  maxHistory: 3
  upgrade:
    remediation:
      retries: 3
  rollback:
    cleanupOnFail: true
  values:
    nameOverride: commute
    image:
      name: vibioh/commute
      tag: "202403091500" # {"$imagepolicy": "default:flux-commute-api:tag"}
    labels:
      tags.datadoghq.com/env: "production"
      tags.datadoghq.com/service: "commute"
      tags.datadoghq.com/version: "202403091500" # {"$imagepolicy": "default:flux-commute-api:tag"}
    env:
      - name: GOMAXPROCS
        valueFrom:
          resourceFieldRef:
            resource: limits.cpu
      - name: GOMEMLIMIT
        valueFrom:
          resourceFieldRef:
            resource: limits.memory
      - name: VERSION
        valueFrom:
          fieldRef:
            fieldPath: metadata.labels['tags.datadoghq.com/version']
      - name: OTEL_SERVICE_NAME
        valueFrom:
          fieldRef:
            fieldPath: metadata.labels['tags.datadoghq.com/service']
    config:
      OTEL_RESOURCE_ATTRIBUTES: env=production,git.repository_url=github.com/ViBiOh/commute
      COMMUTE_LOGGER_JSON: "true"
      COMMUTE_MAPBOX_ACCESS_TOKEN: pk.eyJ1IjoidmliaW9oIiwiYSI6ImNqMzFmbTFoOTAwMWMycW82YXppbGRidXAifQ.bb6xyGsr1kQW3UozHS2Pmw
      COMMUTE_PUBLIC_URL: https://commute.vibioh.fr
      COMMUTE_TELEMETRY_URL: datadog.observability:4317
    secrets:
      COMMUTE_STRAVA_CLIENT_ID: AgAk5OcuIvcCxMiB9xvn5+jttopqFAFAUcSND4tbwWuaFq14VylLth8xZu+Rvx8vS5WN/Vxh25tXOrHHrvZPpdEV9rFVGvZtzIAQk63zVeaAnP82Z7IaMFERE89zKUPxOvmWhJPDugj17fRt3JpQZZ5wB/lZ19aruK0E8LIx9QBjqGrTy7bShPlDVWbnqxuGDRY+5afWs2BxKmDHku3LFK5FGIXfMZ8I221tKfuC3Yig0v7b/U3iY130T01r7UkH7JdZS6PKaaIOG70so8Rq7dajiMtB5qK+z7UQ9gGzcabqIdKYWJZs9xqnEjIR1/IuWlXq6F6/2bF5turTGePmtd9uNEUGw6vpNeWqcxD/oM+v/J91D95G5GXJHuKiqS8D9tGsIm23fUtkAfDdGrdYYkRMuLSOBsW1pVlQT2nxkVkz1+7B/PEAk/JYdIDHpcmjCmCU4ADBkVi8MM+rHlvHHBp9Jq2o928M9OFFXvCdLlF0ZGQuyZyfUq49ERmPKHZkZbbQOJ+xWnLapO8bMCtC9vVfBh8blh+tXcWr4n36H2E7KVo5QqbQWMu2aKPx6rGLwXnPOA+WyHi7fQAY80cqQ31rtEBmf7mI/hxUmT7wq0Bzw4sGq6yx9t9JcdM+FLJycEtZJiek/YWJrAQasntGkZ9sKrEKQNcT0uoUtApLdygXKSw4zrJE9ZyGGUR5bin4WPnKpsczSao=
      COMMUTE_STRAVA_CLIENT_SECRET: AgChrnm4LIVo/slVf35EF4NRpW2rC9FPrbtVumZqmt47msO5baOQ408fa5RZru/dQoRA04kl3XUH/MNQpQqywiAfusWG9JcFKZpM3C0Nd1Dlx6HxofrhftUPf6tPt2dr5bZdG9ZG5lN0L/amDkN926TM7gINsfIWtJGU5CiBm1z/uzjRbvuc8OqBFIFKk14On7JdLGaB5Um6/sgWl7QE1Z45jsJFjj+PAafZjjQEiXdKBw7Q9Rt1WZkq8w3yeiGWct4xM1UX1rInj21zUJ24l7I4PnFjqDUG2CL5mWPTD+Avt2ciB3tXDBBM986p5cHQzV0yrj4thch1cFSRyELequt+SXh9A7V15yT6TPLIMx+Ag5sh9okrn5zLaCBGDzvnl0io05elnJ9HmsJrSJg9dlDuiOWLRYj8bOqrvVp6zOj7tdcefvFn+4uIilmeNvyj+pBm3J0nnpqNM/w0Wn84lqZFgCXeENqs0o/eXY7UduRk7Xhoja554SIXaXO/bEdZBtkRR/+CpD/TaYMeNFAObLzdGhfrVciDCZkqB4oh5SJwIEghk0wP9jrWVK7Sr1ja6bCkvA3p5GL97V1/l3PNzV9Lqlqq2/SrUtS0zEvryCtiY+FnMSur9p09SNs2Rwmvh30Mhy9FjnNhc4hV5uugh873bD3RRuZqF9YwC9FVgUktBJ5Yl/RgihuhqChd4tO1diBZF5pQvS1RrBx5wZdVOqoMGM4SyAtJs7BuKEd7zydzCf9fnRcUXf/2
    pprof:
      enabled: true
